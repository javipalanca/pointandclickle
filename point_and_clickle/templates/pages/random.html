{% extends "base_amoeba.html" %}
{% load resize %}

{% block modal %}
    <div class="modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img class="card-img-top mx-auto d-block" src="" alt="Game cover">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item" id="card-developer"></li>
                            <li class="list-group-item" id="card-platform"></li>
                            <li class="list-group-item" id="card-genre"></li>
                        </ul>
                        <a href="#" class="btn btn-primary" id="result-link" target="_blank">Link to Adventure
                            Gamers</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}

    <div class="container">
        <div class="row">
            <h1>You have 6 tries to guess today's Point&Click game...</h1>
        </div>

        <div class="row" id="searchbox">

            <div class="offset-lg-3 col-md-10 col-9 col-lg-5  twitter-typeahead" id="remote">
                <input type="text" class="typeahead tt-input" id="input"
                       placeholder="Guess the point & click game...">
            </div>
            <div class="col-md-1 col-1">
                <div class="btn-group" role="group">
                    <button type="submit" class="btn btn-submit btn-outline-darkgreen" id="submit">Submit
                    </button>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="container-fluid d-flex justify-content-center p-2 col-xs-12 col-md-12 col-lg-10 col-xl-6">
                <img class="screenshot rounded mx-auto hide" id="img0" src="{{ game.screenshots.5 | resize }}"
                     alt="First screenshot">
                <img class="screenshot rounded mx-auto hide" id="img1" src="{{ game.screenshots.4 | resize }}"
                     alt="Second screenshot">
                <img class="screenshot rounded mx-auto hide" id="img2" src="{{ game.screenshots.3 | resize }}"
                     alt="Third screenshot">
                <img class="screenshot rounded mx-auto hide" id="img3" src="{{ game.screenshots.2 | resize }}"
                     alt="Fourth screenshot">
                <img class="screenshot rounded mx-auto hide" id="img4" src="{{ game.screenshots.1 | resize }}"
                     alt="Fifth screenshot">
                <img class="screenshot rounded mx-auto hide" id="img5" src="{{ game.screenshots.0 | resize }}"
                     alt="Sixth screenshot">
            </div>
        </div>
        <div class="row">
            <div class="container-fluid d-flex justify-content-center p-2">
                <div class="btn-group" role="group">
                    <button id="button0" type="button" class="btn btn-outline-darkgreen guess">1</button>
                    <button id="button1" type="button" class="btn btn-outline-darkgreen guess">2</button>
                    <button id="button2" type="button" class="btn btn-outline-darkgreen guess">3</button>
                    <button id="button3" type="button" class="btn btn-outline-darkgreen guess">4</button>
                    <button id="button4" type="button" class="btn btn-outline-darkgreen guess">5</button>
                    <button id="button5" type="button" class="btn btn-outline-darkgreen guess">6</button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="container-fluid d-flex justify-content-center p-2">
                <div class="btn-group" role="group">
                    <i id="result0" class="bi bi-hand-index color-grey hide"></i>
                    <i id="result1" class="bi bi-hand-index color-grey hide"></i>
                    <i id="result2" class="bi bi-hand-index color-grey hide"></i>
                    <i id="result3" class="bi bi-hand-index color-grey hide"></i>
                    <i id="result4" class="bi bi-hand-index color-grey hide"></i>
                    <i id="result5" class="bi bi-hand-index color-grey hide"></i>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="container-fluid d-flex justify-content-center p-2 alert alert-info" id="divguesses">
                <span id="remaining"></span>&nbsp;guesses remaining.
            </div>
        </div>

        <div class="row">
            <div class="container-fluid d-flex justify-content-center p-2">
                <ul id="guesses-list" class="list-group"></ul>
            </div>
        </div>

    </div>
{% endblock %}

{% block inline_javascript %}
    {{ block.super }}
    <script src="//code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>

    <script>
        $(function () {
            let titlesDisplay = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace,
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                sufficient: 1,
                limit: 100,
                remote: {
                    wildcard: '%QUERY',
                    url: "/game-autocomplete/?q=%QUERY",
                    //transform: response => $.map(response.results, game => ({value: game.text}))
                }
            });
            titlesDisplay.initialize();

            $('#remote .typeahead').typeahead({
                    classNames: {
                        input: 'form-control',
                        suggestion: 'list-group-item',
                        hint: 'form-control'
                    },
                    minLength: 1,
                    highlight: true,
                    hint: true
                },
                {
                    name: 'games',
                    limit: 20,
                    source: titlesDisplay.ttAdapter(),
                    //displayKey: 'value'
                });

            let result = {"code": "{{ result }}", "id": "{{ game.id }}"};
            let csrf_token = $('{% csrf_token %}');
            init_wordle(result, csrf_token.attr("value"));
        });

    </script>

{% endblock %}
